<!DOCTYPE HTML>
<HTML>
 <HEAD>
  <TITLE> JSC3D - read_chung </TITLE>
  <!--meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"-->
  <!--meta charset="ISO-8859-1"-->
  <meta charset="utf-8">
 </HEAD>

 <BODY>
<!--a href="https://drive.google.com/?tab=wo&authuser=0#folders/0B6GM9ay7ImZLM0xQVjFWSkliS0U">https://drive.google.com/? open source chatbot_chung _________</a--> 
<a href="http://translate.yandex.com/" target="_blank">"Powered by Yandex.Translate"</a>
<a href="http://responsivevoice.org/" target="_blank"> & "responsivevoice"</a>
<script type="text/javascript" src='https://code.responsivevoice.org/responsivevoice.js'></script>
	<div style="width:98%; height:98%px; font-size: 9pt; color: #F77777;"  onKeyDown="mykeypress(event);" >
		<canvas id="cv" style="border: 1px solid;" width="550" height="550" ></canvas>
		<textarea id="msg" rows="18" cols="40" type="text">msg</textarea>
		<div id="divmsg" >
	    <button id="prev"  onclick="subPREV();">PREV</button>
	    <button id="prev"  onclick="subprev();">prev</button>
	    <button id="next"  onclick="subnext();">next</button>
	    <button id="prev"  onclick="subNEXT();">NEXT</button>
	    <button id="pause"  onclick="subpause();"  onblur="tfocus=1;" onfocus="tfocus=0">pause</button>
	    <button id="quit"  onclick="subquit();" >quit</button>
		</div>
		<canvas id="cvmsg" style="position:absolute;top:550px;left:14px;border:none;" width="290" height="24" hidden></canvas>
		<div style="left:0px; " onmousemove="mousemove(event);">
		<!--button id="reset"  onclick="reset2();">reset</button-->
		<input type="text" onmousedown="reset2();" id="intext" maxlength="35" size="30" value=""/>
		<!--button id="say"  onclick="say();">say</button-->
    <select id="combo" onChange="subcombo();" onblur="tfocus=1;" onfocus="tfocus=0;">
       <option id="en">english</option>
       <option id="auto">auto</option>
       <option id="fr">francais</option>
       <option id="de">german</option>
       <option id="it">italian</option>
       <option id="es">spanish</option>
    </select>
	<button id="select"  onclick="subimport();">select txt file</button>
    <input type="file" id="files" name="files[]" />
	    <button id="save"  onclick="subsave();">save</button>
		</div>
		<div style="left:410px; top:30px; position:absolute;" hidden>
		<textarea id="msg0" rows="18" cols="40" type="text">msg</textarea>
        <a id="ntest"> 0</a>
		</div>
	</div>
	<!--script type="text/javascript" src="mytemplates.js"></script>
	<script type="text/javascript" src="mypatterns.js"></script>
	<script type="text/javascript" src="mywords.js"></script>
	<script type="text/javascript" src="mywordspatt.js"></script>
	<script type="text/javascript" src="mystarpatt.js"></script>
	<script type="text/javascript" src="mystarpatt2.js"></script>
	<script type="text/javascript" src="mystartemp.js"></script>
	<script type="text/javascript" src="mythats.js"></script>
	<script type="text/javascript" src="mytopics.js"></script-->
	<!--  please put here your own yandex-translate free key -->  
	<script type="text/javascript" src="myyandexkey.js"></script>
    <script type="text/javascript">
 	var myvbuff=new Array(100000);
	var mynvert=0;var auxvar="",auxtext="";
	var test=112;var mymesh=null;var dataobj="";var myscene=null,mytexture=null;
	var imagesrc="";var mymesh1=null,mymesh2=null,mymesh3=null,mymesh4=null,bodytext=null;
    </script>
	<!--script type="text/javascript" src="chatbot_chung_prog.js"></script-->
	<script type="text/javascript" src="helene_obj.js"></script>
	<script type="text/javascript" src="heleneeye_obj.js"></script>
	<script type="text/javascript" src="helenemouth_obj.js"></script>
	<script type="text/javascript" src="helenemoutho_obj.js"></script>
	<script type="text/javascript" src="helenesmile_obj.js"></script>
	<script type="text/javascript" src="helene_jpg.js"></script>
	<!--script type="text/javascript" src="alexiabody2_obj.js"></script>
	<script type="text/javascript" src="alexiabody2_jpg.js"></script-->
	<script type="text/javascript" src="myjsc3d.js"></script>
	<script type="text/javascript" src="ciel_jpg.js"></script>
	<script type="text/javascript">
    var crlf=String.fromCharCode(13)+String.fromCharCode(10);
    var cr=String.fromCharCode(13),lf=String.fromCharCode(10);
	var canvas;
	var viewer;
    var vbuff0=[];var vbuff1=[];
	var vbuff2=[];var vbuff3=[];var vbuff4=[];var nvbuff=0;
	var myimage=new Image;
	myimage.width=512;myimage.height=512;
	myimage.src=helenejpg;
	/*var myimage2=new Image;
	myimage2.width=512;myimage2.height=512;
	myimage2.src=alexiabody2jpg;*/
	function printmsg(txt){
	   document.getElementById("msg").value=txt+crlf+auxtext;}
	function init() {
		canvas = document.getElementById('cv');
		var wx= parseInt(window.innerWidth*0.98);
        var wy= parseInt(window.innerHeight*0.89);
		//var k=600/740;wx=parseInt(k*wx);wy=parseInt(k*wy);
		canvas.width=Math.min(wx,wy);  
		canvas.height=Math.min(wx,wy); 
        document.getElementById("msg").setAttribute("style",
	         "top:0px;left:0px;width:350px;height:"+(Math.min(wx,wy)-4)+"px;");
        document.getElementById("divmsg").setAttribute("style",
	         "position:absolute;top:"+(Math.min(wx,wy))+"px;left:"+(Math.min(wx,wy)+20)+"px;");
        var object=document.getElementById('msg');
	    object.style.font=" bold 13px arial,sans-serif"; 
        //object.style.font = "italic small-caps bold 16px arial, sans-serif";
		viewer = new JSC3D.Viewer(canvas);
	    //viewer.setParameter('SceneUrl', '../demos/models/helene.obj');
		viewer.setParameter('SceneUrl', '');
		viewer.setParameter('InitRotationX', -90);
		viewer.setParameter('InitRotationY', -5);
		viewer.setParameter('InitRotationZ', 0);
		viewer.setParameter('ModelColor', '#FFFFFF');
		viewer.setParameter('BackgroundImageUrl',cieljpg);
		viewer.setParameter('BackgroundColor1', '#AFAFFF');
		viewer.setParameter('BackgroundColor2', '#8FAFAF');
		viewer.setParameter('RenderMode', 'texturesmooth');
		viewer.setParameter('MipMapping', 'on');
		viewer.setParameter('Definiton', 'standard');
		viewer.setParameter('Renderer', '');
		viewer.init();
		viewer.update();
		//alert(helenemouthobj.length);
		mymesh=new JSC3D.Mesh;
		mymesh.name='mymesh';
		mymesh.vertexBuffer=[];
		mymesh.indexBuffer=[];
		mymesh.texCoordBuffer=[];
		mymesh.texCoordIndexBuffer=[];
		mymesh.isDoubleSided=true;
		var mtllibs=viewer.parseObj(mymesh,heleneobj);
		mymesh.init();
		//alert("mtl="+mtllibs.length);
		/*mymesh4=new JSC3D.Mesh;
		mymesh4.name='mymesh';
		mymesh4.vertexBuffer=[];
		mymesh4.indexBuffer=[];
		mymesh4.texCoordBuffer=[];
		mymesh4.texCoordIndexBuffer=[];
		var mtllibs4=viewer.parseObj(mymesh4,alexiabody2obj);
		mymesh4.init();*/
		myscene=new JSC3D.Scene;
	    myscene.addChild(mymesh);
	    //myscene.addChild(mymesh4);
		viewer.replaceScene(myscene);
		viewer.update();
        //alert("addmesh");
		
		mymesh1=new JSC3D.Mesh;
		mymesh1.name='mymesh1';
		mymesh1.vertexBuffer=[];
		mymesh1.indexBuffer=[];
		mymesh1.texCoordBuffer=[];
		mymesh1.texCoordIndexBuffer=[];
		var mtllibs1=viewer.parseObj(mymesh1,heleneeyeobj);
		mymesh1.init();

		mymesh2=new JSC3D.Mesh;
		mymesh2.name='mymesh2';
		mymesh2.vertexBuffer=[];
		mymesh2.indexBuffer=[];
		mymesh2.texCoordBuffer=[];
		mymesh2.texCoordIndexBuffer=[];
		var mtllibs2=viewer.parseObj(mymesh2,helenemouthobj);
		mymesh2.init();

		mymesh3=new JSC3D.Mesh;
		mymesh3.name='mymesh3';
		mymesh3.vertexBuffer=[];
		mymesh3.indexBuffer=[];
		mymesh3.texCoordBuffer=[];
		mymesh3.texCoordIndexBuffer=[];
		var mtllibs3=viewer.parseObj(mymesh3,helenemouthoobj);
		mymesh3.init();
		
		mymesh4=new JSC3D.Mesh;
		mymesh4.name='mymesh4';
		mymesh4.vertexBuffer=[];
		mymesh4.indexBuffer=[];
		mymesh4.texCoordBuffer=[];
		mymesh4.texCoordIndexBuffer=[];
		var mtllibs4=viewer.parseObj(mymesh4,helenesmileobj);
		mymesh4.init();
		
		setTimeout("init0();",50);
	}
	function init0(){
		//mymesh=myscene.children[0];
		mytexture=new JSC3D.Texture;
	    mytexture.onready = function() {
		 mymesh.setTexture(this);
		 viewer.update();
		};
	    //mytexture.createFromUrl('https://sites.google.com/site/chungkn1400/myjava/helene.jpg?attredirects=0');
		//alert(document.images.img.src);
		mytexture.createFromImage(myimage);
		//mymesh.setTexture(mytexture);
	    mymesh.setRenderMode('texturesmooth');
		//if(mymesh.hasTexture()){alert("mytexture");}
		//canvas.width=canvas.height=512;
		//var ctx = document.getElementById('cv').getContext('2d');
		//var image=document.images.img;
		//ctx.drawImage(myimage, 0, 0,400,400);
		//alert("testcanvas");
		/*bodytext=new JSC3D.Texture;
	    bodytext.onready = function() {
		 mymesh4.setTexture(this);
		 viewer.update();
		};
		bodytext.createFromImage(myimage2);
		//mymesh4.setTexture(bodytext);
	    mymesh4.setRenderMode('texturesmooth');
		for(var i=0;i<(mymesh4.vertexBuffer.length-2);i+=3){
		   mymesh4.vertexBuffer[i]*=18.0;
		   mymesh4.vertexBuffer[i+1]*=18.0;
		   mymesh4.vertexBuffer[i+2]*=18.0;
		   mymesh4.vertexBuffer[i]+=-1.2;
		   mymesh4.vertexBuffer[i+1]+=22.0;
		   mymesh4.vertexBuffer[i+2]+=13.0;
		}*/
	    mynvert=mymesh.vertexBuffer.length;
		//viewer.update(); 
		if (mynvert>mymesh1.vertexBuffer.length){mynvert=mesh1.vertexBuffer.length;}
		if (mynvert>mymesh2.vertexBuffer.length){mynvert=mesh2.vertexBuffer.length;}
		if (mynvert>mymesh3.vertexBuffer.length){mynvert=mesh3.vertexBuffer.length;}
		if (mynvert>mymesh4.vertexBuffer.length){mynvert=mesh4.vertexBuffer.length;}
		if (mynvert>100000){mynvert=100000;}
		//alert("init0 nvert="+mynvert);
		setTimeout("init2();",50);
    }
    function init2(){
		nvbuff=mynvert;
		var sc=1.06;
		var scale=[],scalex=0.95*sc,scaley=0.965*sc,scalez=1.04*sc,dz=[];
		var scale2=[];
		for(var i=0; i<nvbuff; i+=3){
		    scale[i]=scalex;scale[i+1]=scaley;scale[i+2]=scalez;
			dz[i]=0;dz[i+1]=0;dz[i+2]=-14*sc;
			var y=mymesh.vertexBuffer[i+1];
			if(y>0){scale2[i]=0;scale2[i+1]=0;scale2[i+2]=0;}
			else{scale2[i]=scalex;scale2[i+1]=scaley;scale2[i+2]=scalez;}
			}
		for(var i=0; i<nvbuff; i++){
		   vbuff0.push(mymesh.vertexBuffer[i]*scale[i]+dz[i]);
		   vbuff1.push((mymesh1.vertexBuffer[i]-mymesh.vertexBuffer[i])*scale2[i]);
		   vbuff2.push((mymesh2.vertexBuffer[i]-mymesh.vertexBuffer[i])*scale2[i]);
		   vbuff3.push((mymesh3.vertexBuffer[i]-mymesh.vertexBuffer[i])*scale2[i]);
		   vbuff4.push((mymesh4.vertexBuffer[i]-mymesh.vertexBuffer[i])*scale2[i]);
		}
		mymesh1.vertexBuffer=null;
		mymesh1.indexBuffer=null;
		mymesh1.texCoordBuffer=null;
		mymesh1.texCoordIndexBuffer=null;
		mymesh2.vertexBuffer=null;
		mymesh2.indexBuffer=null;
		mymesh2.texCoordBuffer=null;
		mymesh2.texCoordIndexBuffer=null;
		mymesh3.vertexBuffer=null;
		mymesh3.indexBuffer=null;
		mymesh3.texCoordBuffer=null;
		mymesh3.texCoordIndexBuffer=null;
		mymesh4.vertexBuffer=null;
		mymesh4.indexBuffer=null;
		mymesh4.texCoordBuffer=null;
		mymesh4.texCoordIndexBuffer=null;
    	heleneeyeobj=null;
	    helenemouthobj=null;
		helenemouthoobj=null;
		helenesmileobj=null;
	    heleneobj=null;
		helenejpg=null;
		document.getElementById('intext').focus();
		//initelizabot();
		var msg="enter a text"+crlf+crlf+crlf+"enter => repeat"+crlf+crlf;
		msg+="page number => jump to page"+crlf+crlf;
		msg+="up/down arrows => prev/next page"+crlf+crlf;
		printmsg(msg);
		setTimeout("loop();",50);
}
	var mousex0=0;
	function mousemove(e){
    if ((e.clientX - mousex0)>2){
	mousex0=e.clientX;viewer.rotMatrix.rotateAboutYAxis(5);
	viewer.update();};
	if ((mousex0 - e.clientX)>2){
	mousex0=e.clientX;viewer.rotMatrix.rotateAboutYAxis(-5);
	viewer.update();};
	}
    
	function gettimer(){
    return Date.now();//(new Date()).getTime();
    }
	var iloop=0,tloop=0,quit=0,tkeye=0;
	var keye=0,kmouth=0,kmoutho=0,ksmile=0;
	function loop(){
    testspeak();
	iloop +=1;if(iloop>70){iloop=1;};
	if (iloop<=35){viewer.rotMatrix.rotateAboutYAxis(0.2);}
	if (iloop>35){viewer.rotMatrix.rotateAboutYAxis(-0.2);}
    var Timer=gettimer()/1000.0;
	var ktime=1.5;
    keye=(Math.sin(Timer*ktime-tkeye)*1.3+0.7)*0.32;
    ksmile=(Math.cos(Timer*ktime*0.3)*1.3+0.7)*0.42;
    drawphonemes();
    var kmouth2=kmoutho;//'(Cos(Timer*ktime*0.75)+1)*0.64
    var kmouth1=kmouth+(Math.cos(Timer*ktime*0.85)+0.7)*0.15+kmoutho*0.3;
    var kfps=2.4;
	if ((Math.random()<0.03*kfps) && (keye>1.45*0.32)){keye=0;tkeye=Timer*ktime;}
	var vbuf = mymesh.vertexBuffer;
	var nvbuf=vbuf.length;
	if (nvbuf>nvbuff){nvbuf=nvbuff;};
    var sc=0.895;kmouth1*=sc;kmouth2*=sc;
    for (var i=0;i<nvbuf;i++){
   	  vbuf[i]=(vbuff0[i]+keye*vbuff1[i]+(kmouth1*vbuff2[i])+(kmouth2*vbuff3[i])+(ksmile*vbuff4[i]));
   	} 
	viewer.update();
	//subfocus();
	if (quit==0){tloop=setTimeout("loop();",40);}
	}
	function reset(){
	viewer.resetScene();
	viewer.update();
	}
	function reset2(){
	reset();
    intext0="";
	document.getElementById('intext').focus();
	}
	var tsubfocus=0,tfocus=1;
	function subfocus(){
	 var timer=gettimer();
	 if(timer>tsubfocus+3000){tsubfocus=timer;
	  var text=document.getElementById('intext').value;
	  if(tfocus){document.getElementById('intext').value="";}
	  if(tfocus){document.getElementById('intext').value=text;}
	  if(tfocus){document.getElementById('intext').focus();}
	 } 
	}  
	function resetvars(){};
var phoneme="",phoneme0="",inword="",inword0="";
var nphoneme=7,iphoneme=0;
var phonemes=new Array(nphoneme);
var tphoneme=new Array(nphoneme);

function addphoneme(iphon){
var Timer=gettimer()/1000.0;
iphoneme+=1;if(iphoneme>nphoneme){iphoneme=1;};
phonemes[iphoneme]=iphon;
tphoneme[iphoneme]=Timer;
} 
function drawphoneme(i){
var ktime,dt,dtt,d1;
var Timer=gettimer()/1000.0;
ktime=4.5;//'2.80
dt=tphoneme[i]-Timer;
if(dt<-19){tphoneme[i]=0;}
dtt=dt*ktime*0.75;
if(dtt>3.1416){return;}
d1=0.82;
switch(phonemes[i]){
	case 'o':
   kmoutho+=(Math.sin(dtt)+d1)*0.64;
   kmouth+=kmoutho*0.3;break;
	case 'u':
   kmoutho+=(Math.sin(dtt)+d1)*0.64;
   kmouth+=kmoutho*0.3;break;
	case 'i':
   kmoutho+=(Math.sin(dtt)+d1)*0.24;
   kmouth+=kmoutho*0.3;
   kmouth+=(Math.sin(dtt)+0.7)*0.3;break;
   ksmile+=kmoutho*0.3;
	case 'e':
   kmoutho+=(Math.sin(dtt)+d1)*0.24;
   kmouth+=kmoutho*0.3;
   kmouth+=(Math.sin(dtt)+0.7)*0.25;break;
	case 'w':
   kmoutho+=(Math.sin(dtt)+d1)*0.2;
   kmouth+=kmoutho*0.3;
   kmouth+=(Math.sin(dtt)+0.7)*0.3;break;
	case 'x':
   kmoutho+=(Math.sin(dtt)+d1)*0.15;
   kmouth+=kmoutho*0.2;
   kmouth+=(Math.sin(dtt)+0.7)*0.2;break;
	case 'r':
   kmoutho+=(Math.sin(dtt)+d1)*0.18;
   kmouth+=kmoutho*0.3;
   kmouth+=(Math.sin(dtt)+0.7)*0.24;break;
	case 'm':
   kmoutho+=(Math.sin(dtt)+d1)*0.18;
   kmouth+=kmoutho*0.3;
   kmouth+=(Math.sin(dtt)+0.7)*0.27;break;
	case 't':
   kmoutho+=(Math.sin(dtt)+d1)*0.18;
   kmouth+=kmoutho*0.2;
   kmouth+=(Math.sin(dtt)+0.7)*0.27;break;
	case 'ch':
   kmoutho+=(Math.sin(dtt)+d1)*0.18;
   kmouth+=kmoutho*0.25;
   kmouth+=(Math.sin(dtt)+0.7)*0.3;break;
	
	default: 
   kmouth+=(Math.sin(dtt)+0.7)*0.4;break;
		
   }
}

function drawphonemes(){
if (phoneme!=phoneme0){
	phoneme0=phoneme;
 	if (phoneme==" "){
 		//inword0=inword;
 		for( var i=1;i<=nphoneme;i++){
 			tphoneme[i]=0;
        }
	}
 	if (phoneme!=" "){addphoneme(phoneme);}
}
kmoutho=0;
kmouth=0;
var Timer=gettimer()/1000.0;
for (var i=1;i<=nphoneme;i++){
	if (Timer<(tphoneme[i]+1)){
		drawphoneme(i);
	}
}
}
var audiotime0=0,audiotime1=0,textspeak="",text="",audiosrc="",words=[];
var textspeakall="";
var abc="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890+-*/()[]=.'";
var audio = null;//new Audio();
var tsay=0,vsay=14.0;
var speechstart=0,speechend=0;
function speakhtml(){
if ('speechSynthesis' in window){
tsay=1;
//alert(textspeak);
if(textspeak.length<1){return;}
var u=null;
try{
u = new SpeechSynthesisUtterance(textspeak);
}
catch(err){tsay=0;};if(tsay==0){return;}
textspeak=textspeak+" ";
u.lang = lang;//'en';
u.rate = 0.65;
//var voices = window.speechSynthesis.getVoices();
//u.voice=voices[0];alert(voices[0].name);
u.onstart = function(event) { 
  var Timer=gettimer()/1000.0;
  //speechstart=Timer;//alert("speechstart="+speechstart);
  audiotime0=Timer;//speechstart;
  audiotime1=Timer+(textspeak.length/(vsay+1.0));  
  };
u.onend = function(event) { 
  var Timer=gettimer()/1000.0;
  //speechend=Timer;alert("speechend="+speechend);
  var len=textspeak.length;
  if(len>2){vsay+=(len/(Timer-audiotime0+0.1)-vsay)*0.35;};//0.01
  audiotime1=audiotime0;  
  //alert(vsay);
  };
window.speechSynthesis.speak(u);
document.getElementById('intext').value="";
if(tfocus==1){document.getElementById('intext').focus();}
}
}
function replaceall(text0,str1,str2){
    var text=text0;
	for(var p=0;p<100;p++){
	   if(text.indexOf(str1)<0){break;}
	   text=text.replace(str1,str2);
	   }
	return text;   
}
function formatinput(text0){
var text=replaceall(text0,'"',' ');//.toLowerCase();
text=replaceall(text,lf,".");
text=replaceall(text,cr,".");
text=replaceall(text,"'"," ");

//text=replaceall(text,"("," ");
//text=replaceall(text,")"," ");
//text=replaceall(text,"?"," ");
//text=replaceall(text,"é","e");
//text=replaceall(text,"è","e");
//text=replaceall(text,"ê","e");
text=replaceall(text,"ë","é");
text=replaceall(text,"î","i");
text=replaceall(text,"ï","i");
text=replaceall(text,"ö","o");
text=replaceall(text,"ó","o");
text=replaceall(text,"û","u");
text=replaceall(text,"ü","u");
text=replaceall(text,"ä","a");
text=replaceall(text,"â","a");
text=replaceall(text,"à","a");
text=replaceall(text,"ì","i");
text=replaceall(text,"ò","o");
text=replaceall(text,"ù","u");
//text=replaceall(text,"ç","c");

text=replaceall(text,",","@");
text=replaceall(text,"@"," , ");
text=replaceall(text,";","@");
text=replaceall(text,"@"," ; ");
text=replaceall(text,":","@");
text=replaceall(text,"@"," : ");
text=replaceall(text,".","@");
text=replaceall(text,"@"," . ");
text=replaceall(text,"!","@");
text=replaceall(text,"@"," ! ");
for(var i=0;i<200;i++){text=replaceall(text,"  "," ");}
return text.trim();
}
function formatoutput(text0){
var text=text0;//.toLowerCase();
//text=replaceall(text,"é","e");
//text=replaceall(text,"è","e");
//text=replaceall(text,"ê","e");
//text=replaceall(text,"ë","e");
text=replaceall(text,"î","i");
text=replaceall(text,"ô","o");
text=replaceall(text,"ù","u");
text=replaceall(text,"û","u");
text=replaceall(text,"à","a");
text=replaceall(text,"â","a");
text=replaceall(text,"ç","c");
return text.trim();
}
var intext0="";var vars=[];var icookie=0;
function say(){
//alert("/"+formateval("okeval(elizawords.length) eval(v['y'];v['y']+=1)")+"/");
//icookie+=1;if(icookie>11){icookie=0;savecookie();}
//reset();
nextsub="";
var intext=document.getElementById('intext').value;
if(parseInt(intext)>0 && filetext.length>=9){
   ifiletext=Math.max(0,Math.min(filetext.length-8,(parseInt(intext)-1)*1000));
   setTimeout('subsuite();',30);
   document.getElementById('intext').value="";
   return;}
tspeaktext=0;audiotime1=audiotime0;//ifiletext=0;jfiletext=0;
intext=formatinput(intext);
var intext2=intext.trim(),txt2="";
if(intext==""){intext=intext0;}//+" .";};
intext=replaceall(intext,"&"," ");
if(intext==""){intext=" ";}
intext0=intext;
//nextsub='say1("'+intext+'");';
nextsub='say2("'+intext+'");';
if(intext!="*"){detectlang(intext+"+"+intext);}
else{say2(intext);}
}
var tspeaktext=0,ifiletext=0,jfiletext=7000,langcombo0="",ntest0=0;
function saytxt0(){
if(langcombo==langcombo0 && langcombo!="auto"){setTimeout('saytxt1();',30);return;}
langcombo0=langcombo;
nextsub="setTimeout('say21();',3000);";
detectlang(filetext.substr(Math.max(0,Math.min(40,filetext.length-40)),40));
}
function say21(){
nextsub="saytxt1();";
detectlang(filetext.substr(Math.max(0,Math.min(40,filetext.length-40)),40));
}
function saytxt1(){
tspeaktext=0;//ifiletext=0;jfiletext=0;
if(ifiletext0>0 && ifiletext0<=filetext.length-8){ifiletext=ifiletext0;}
ifiletext0=0;
if(filename==filenameinit){if(ifiletextinit){ifiletext=ifiletextinit;}}
audiotime1=0.5+gettimer()/1000;audiotime0=audiotime1-0.01;
saytxt();
}
function subprev(){
if(tspeaktext!=2){return;}
tspeaktext=0;ifiletext=Math.max(0,ifiletext-1000);
if(ifiletext>1){
   for(var j=0;j<400;j++){if("?!.".indexOf(filetext.substr(ifiletext+j,1))>=0){ifiletext+=j;break;}}}
jfiletext=ifiletext+7000;
audiotime1=0.5+gettimer()/1000;audiotime0=audiotime1-0.01;
saytxt();
}
function subnext(){
if(tspeaktext!=2){return;}
tspeaktext=0;ifiletext=Math.min(filetext.length-1,ifiletext+1000);
if(ifiletext<filetext.length-1){
   for(var j=0;j<400;j++){if("?!.".indexOf(filetext.substr(ifiletext-j,1))>=0){ifiletext-=j;break;}}}
jfiletext=ifiletext+7000;
audiotime1=0.5+gettimer()/1000;audiotime0=audiotime1-0.01;
saytxt();
}
function subPREV(){
if(tspeaktext!=2){return;}
tspeaktext=0;
var j0=200,j1=ifiletext,test=0;
if(ifiletext>j0+1){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext-j,6)==crlf+crlf+crlf){j0=j;test=1;break;}}}
if(ifiletext>j0+1 && test==0){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext-j,3)==cr+cr+cr){j0=j;test=1;break;}}}
if(ifiletext>j0+1 && test==0){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext-j,3)==lf+lf+lf){j0=j;test=1;break;}}}
ifiletext=Math.max(0,ifiletext-j0-300);
if(ifiletext>1){
 var j0=8,j1=300,test=0;
 if(ifiletext<filetext.length-(j0+1)){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext+j,6)==crlf+crlf+crlf){j0=j;test=1;break;}}}
 if(ifiletext<filetext.length-(j0+1) && test==0){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext+j,3)==cr+cr+cr){j0=j;test=1;break;}}}
 if(ifiletext<filetext.length-(j0+1) && test==0){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext+j,3)==lf+lf+lf){j0=j;test=1;break;}}}
 ifiletext=Math.min(filetext.length-80,ifiletext+j0);
}
jfiletext=ifiletext+7000;
audiotime1=0.5+gettimer()/1000;audiotime0=audiotime1-0.01;
saytxt();
}
function subNEXT(){
if(tspeaktext!=2){return;}
tspeaktext=0;
var j0=200,j1=filetext.length-ifiletext,test=0;
if(ifiletext<filetext.length-(j0+1)){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext+j,6)==crlf+crlf+crlf){j0=j;test=1;break;}}}
if(ifiletext<filetext.length-(j0+1) && test==0){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext+j,3)==cr+cr+cr){j0=j;test=1;break;}}}
if(ifiletext<filetext.length-(j0+1) && test==0){
   for(var j=j0;j<Math.min(900000,j1);j++){if(filetext.substr(ifiletext+j,3)==lf+lf+lf){j0=j;test=1;break;}}}
ifiletext=Math.min(filetext.length-80,ifiletext+j0);
jfiletext=ifiletext+7000;
audiotime1=0.5+gettimer()/1000;audiotime0=audiotime1-0.01;
saytxt();
}
var ifiletext0=0,textspeakall0="";
function subpause(){
alert("pause");return;
if(tspeaktext==2){
                  ifiletext0=ifiletext;textspeakall0=textspeakall;
                  tspeaktext=0;audiotime1=0;audiotime0=0;alert("pause");}
tspeaktext=0;
if(filetext.length<=9){return;}
ifiletext=Math.min(filetext.length-8,ifiletext0);
ifiletext0=0;
jfiletext=ifiletext+7000;
if(textspeakall0==""){textspeakall0="   ";}
audiotime1=0.5+gettimer()/1000;audiotime0=audiotime1-0.01;
saytxt();
tfocus=0;
document.getElementById('pause').focus();
}
function subsuite(){
if(tspeaktext==2){ifiletext0=ifiletext;textspeakall0="";
                  tspeaktext=0;audiotime1=0;audiotime0=0;}
ifiletext0=ifiletext;
tspeaktext=0;
if(filetext.length<=9){return;}
ifiletext=Math.min(filetext.length-8,ifiletext0);
ifiletext0=0;
jfiletext=ifiletext+7000;
audiotime1=0.5+gettimer()/1000;//audiotime0=audiotime1-0.1;
saytxt();
}
var pagemsg="";
function saytxt(){
//alert("/"+formateval("okeval(elizawords.length) eval(v['y'];v['y']+=1)")+"/");
//icookie+=1;if(icookie>11){icookie=0;savecookie();}
//reset();
tspeaktext=1;
nextsub="";
pagemsg=parseInt(ifiletext/1000+1)+"/"+parseInt(filetext.length/1000+1);
jfiletext=ifiletext+1000;jfiletext=Math.min(jfiletext,filetext.length);
for(var j=jfiletext-2;j>ifiletext+10;j-=1){if("!?.".indexOf(filetext.substr(j,1))>=0){jfiletext=j+1;break;}}
var intext=filetext.substr(ifiletext,jfiletext-ifiletext);
intext=formatinput(intext).substr(0,6900);
intext=replaceall(intext,"&"," ");
var intext2=intext.substr(jfiletext-40,40);
if(intext==""){intext=" ";}
//nextsub='say1("'+intext+'");';
nextsub='say2("'+intext+'");';
if(intext!="*" && 0){detectlang(intext2);audiotime1=0.1+gettimer()/1000;}
else{ttranslate=gettimer()-2990;
	 setTimeout(nextsub,30);
     //say2(intext);
	}
}
function say1(intext){//alert(lang+"/"+intext);
//if((langs.indexOf(lang+"-en")<0) || (langs.indexOf("en-"+lang)<0)){lang="en";}
nextsub="say2(translatext);";
translate(intext,lang,"en");
}
function say2(intext){
if(intext=="*"){intext=oldmsg;}
//intext=formatinput(intext);
//alert("intext:"+intext);
text="";
text="."+(intext);//eliza.transform(intext);
//nextsub="say3(translatext);";
//translate(text,"en",lang);
//alert(text);
//text=formateval(text);
//text=text.toLowerCase();
//alert(text);
//}
//function say3(text){
var msg=text;//intext+crlf+text+crlf+crlf;
if(lang!="en" && msg.indexOf(">")>1){
  msg=replaceall(msg,"> >",">");
  msg=replaceall(msg,"> ",">§");
  msg=replaceall(msg,">§",crlf+"> ");
}
//printmsg(">>"+intext0.substr(0,40)+crlf+msg);
printmsg(">>"+pagemsg+crlf+msg);
pagemsg="";
var outmsg=msg.substr(msg.indexOf(">")+2,6999);
var patt=msg.substr(0,msg.indexOf(">"));
if(outmsg.length<0.65*patt.length){
		outmsg=patt+" "+outmsg; 
	}	
if(auxvar!=""){msg+=crlf+"auxvar="+auxvar;};
if(auxvar!=""){printmsg(msg);}
//alert(outmsg);
if(intext0.trim()=="exit"){setTimeout("subquit();",7000);}
words = formatoutput(outmsg).split("");
var words0="";
textspeak="";
for(var i=0; i<words.length; i++){
  if (words[i].length>0){
  if (abc.indexOf(words[i])>=0-999){
  textspeak=textspeak+words[i];};
  if(words0!=" " && words[i]==" "){textspeak=textspeak+" ";};
  words0=words[i];
  ;};};
textspeakall=textspeak;
if(textspeakall0!=""){textspeakall=textspeakall0;}
textspeakall0="";
audiotime1=Math.min(audiotime1,0.2+gettimer()/1000.0);
//speak();
if(tspeaktext==1){
        tspeaktext=2;
		if(tspeaking>1){jfiletext=ifiletext;textspeakall="";}
        //var Timer=gettimer()/1000.0;
        // //if(Timer>audiotime1 && Timer>(3.1+ttranslate/1000)){say();}
        //if(Timer>audiotime0+1 && Timer>(3.1+ttranslate/1000)){say();}
	}
}
</script>
<script src="chatbot_chung_speak.js" >
</script>
<script>
function subquit(){
   //if(filename!=""){subsave();}
   document.location.href="http://chung.blogvie.com/links/";//https://www.google.fr/search?q=nguyen+chung&ie=utf-8&oe=utf-8";
}
function testspeak(){
var Timer=gettimer()/1000.0;
if((Timer>audiotime0) && (Timer<audiotime1+0.1) && (textspeak.length>0)){
  var i=parseInt(textspeak.length*(Timer-audiotime0)/(audiotime1-audiotime0+0.1));//0.01
  phoneme=textspeak.substr(i,1);
  if((i>0) && (phoneme=="h")){if(textspeak.substr(i-1,1)=="c"){phoneme="ch";};};
  if ((i<(textspeak.length-1)) && (phoneme=="c")){if(textspeak.substr(i+1,1)=="h"){phoneme="ch";};};
}else{phoneme=" ";
      if(dtpause>6){dtpause=6;}
      if(textspeakall.length>1 && Timer>(audiotime1+0.2+dtpause*0.2) &&  //0.37//0.02
	     Timer>(audiotime0+0.1+dtpause*0.2) && Timer>tspeaking){ //0.02
	     if(audiotime1<(Timer-0.01)){audiotime1=Timer-0.01;} //0.01
	     if(audiotime0<(Timer-0.01)){audiotime0=Timer-0.01;} //0.01
		 speak();}
	  else if(tspeaktext==2){
	       if(Timer>(audiotime1+2) && jfiletext<filetext.length-1){
		                  audiotime1=Timer;ifiletext=jfiletext;
						  setTimeout("saytxt();",100);}
		   else if(Timer>(audiotime1+3)){tspeaktext=0;ifiletext=0;jfiletext=7000;}}
	  else if(Timer>(audiotime1+3)){tspeaktext=0;ifiletext=0;jfiletext=7000;}
		 }
}
function mykeypress(e) {
    if (e.which == 13 || e.keyCode == 13) {
        var Timer=gettimer()/1000.0;//alert(tspeaktext);
        //if(Timer>audiotime1 && Timer>(3.1+ttranslate/1000)){say();}
        if(Timer>audiotime0+1 && Timer>(3.1+ttranslate/1000)){say();}
		//return false;
    }
    //left = 37,up = 38,right = 39,down = 40,esc=27
    if (e.which == 37 || e.keyCode == 37) {viewer.rotMatrix.rotateAboutYAxis(2);}
    if (e.which == 39 || e.keyCode == 39) {viewer.rotMatrix.rotateAboutYAxis(-2);}
    if (e.which == 38 || e.keyCode == 38 && tspeaktext==2) {subprev();}//viewer.rotMatrix.rotateAboutXAxis(2);}
    if (e.which == 40 || e.keyCode == 40 && tspeaktext==2) {subnext();}//viewer.rotMatrix.rotateAboutXAxis(-2);}
    if (e.which == 27 || e.keyCode == 27) {setTimeout('subquit();',100);}
	//return true;
}

function readcookie(){
var mycookie=document.cookie+";";
//alert("mycookie="+mycookie);
var pref="html5elizabotchung=";
//pref="__utma=";
var i=mycookie.indexOf(pref,0);
if(i<0){return;}
i+=pref.length;
var j=mycookie.indexOf(";",i);
if(j<i){return;}
var mycookie=mycookie.substring(i,j);
//alert(mycookie);
var wcookie=mycookie.split("//");
for(var i=0;i<(wcookie.length-1);i+=2){
    //alert(wcookie[i]+"="+wcookie[i+1]);
    v[wcookie[i]]=wcookie[i+1];
	}
}
function savecookie(){
var mycookie="";
var cookie0=document.cookie;
for(var x in v){
  if((x.indexOf('"',0)<0)&&(x.indexOf("/",0)<0)&&(v[x].indexOf('"',0)<0)&&(v[x].indexOf("/",0)<0)){
  if((x.indexOf('=',0)<0)&&(x.indexOf(";",0)<0)&&(v[x].indexOf('=',0)<0)&&(v[x].indexOf(";",0)<0)){
    mycookie+=x+"//"+v[x]+"//";
    if(mycookie.length>1900){break;}	
  }}
}
//alert(mycookie);  
var pref="html5elizabotchung=";
mycookie =pref+mycookie+"; expires=Fri, 3 Aug 2100 20:47:11 UTC; path=/";
if(mycookie.length>(3900-cookie0.length)){alert("could not save, cookie too long");return;}
document.cookie=mycookie;
}
function deletecookie(){
var pref="html5elizabotchung=";
document.cookie =pref+";expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/";
}
var head = document.getElementsByTagName('head')[0];
var myjson=null,lang="en",translatetext="",ttranslate=0;
var myjson2=null,myjson3=null,nextsub="alert(translatext);";
var langs=["ru-en","ru-pl","ru-uk","ru-de","ru-fr","ru-es","ru-it","ru-bg","ru-cs","ru-tr","ru-ro","ru-sr","en-ru","en-uk","en-de","en-fr","en-es","en-it","en-cs","en-tr","pl-ru","pl-uk","uk-ru","uk-en","uk-pl","uk-de","uk-fr","uk-es","uk-it","uk-bg","uk-cs","uk-tr","uk-ro","uk-sr","de-ru","de-en","de-uk","fr-ru","fr-en","fr-uk","es-ru","es-en","es-uk","it-ru","it-en","it-uk","bg-ru","bg-uk","cs-ru","cs-en","cs-uk","tr-ru","tr-en","tr-uk","ro-ru","ro-uk","sr-ru","sr-uk"];
function myapiCallback(response){//"de","fr","es","it"
	translatext=response.text[0];
	ttranslate=gettimer()-2990;
	setTimeout(nextsub,30);
}
function translate(text,langue,langue2){
if(langue==langue2){translatext=text;
    	ttranslate=gettimer()-2990;
        setTimeout(nextsub,30);return 1;}
var js = document.createElement("script");
js.type = "text/javascript";
js.async=false;
var transtext=replaceall(text," ","+");
var transurl="https://translate.yandex.net/api/v1.5/tr.json/translate?key="+yandexkey+"&lang="+langue+"-"+langue2+"&text="+transtext+"&callback=myapiCallback";
js.src = transurl;
myjson=js;
js.onload = function(){setTimeout("head.removeChild(myjson);",100);};
var timer=gettimer();
if(timer>ttranslate+3000){
  ttranslate=timer;head.appendChild(js);return 1;
}else{return 0;}
}
var lang0="",lang1="",lang2="";
function myapiCallback2(response){//"de","fr","es","it"
	if(lang1==response.lang){lang2=lang1;lang=lang1;}
	else if(lang0==response.lang){lang2=lang0;lang1=lang0;lang=lang0;}
	else{ lang0=lang1;lang1=response.lang;
	      lang2=response.lang;}		  
    if(listlang.indexOf(lang)<0){lang="en";}
	ttranslate=gettimer()-2990;
	setTimeout(nextsub,30);
}
function detectlang(text){
if(langcombo!="auto"){lang=langcombo;
	ttranslate=gettimer()-2990;
	setTimeout(nextsub,30);return 1;}
var js = document.createElement("script");
js.type = "text/javascript";
js.async=false;
var transtext=replaceall(text," ","+");
var transurl="https://translate.yandex.net/api/v1.5/tr.json/detect?key="+yandexkey+"&text="+transtext+"&callback=myapiCallback2";
js.src = transurl;
myjson2=js;
js.onload = function(){setTimeout("head.removeChild(myjson2);",100);};
var timer=gettimer();
if(timer>ttranslate+3000){
  ttranslate=timer;head.appendChild(js);return 1;
}else{return 0;}
}
var listlang=[],listlangname=[],ilang=0;
function myapiCallback3(response){
     var listlangs=response.langs;//alert(listlangs.fr);
	 ilang=0;
	 for(var langcode in listlangs){listlang[ilang]=langcode;
	     listlangname[ilang]=listlangs[langcode];ilang+=1;}
		 //alert(ilang+"/"+listlang[ilang-1]+listlangname[ilang-1]);
     var combo = document.getElementById("combo");
     for(var i=0;i<ilang;i++){
       var option=document.createElement('option');
       option.text=listlang[i]+" "+listlangname[i];
	   option.value=listlang[i];
       combo.add(option, 0);}
	 if(icomboinit>=0){document.getElementById('combo').selectedIndex=icomboinit;}
 		 
}
function getlistlang(){
var js = document.createElement("script");
js.type = "text/javascript";
js.async=false;
var transurl="https://translate.yandex.net/api/v1.5/tr.json/getLangs?key="+yandexkey+"&ui=en&callback=myapiCallback3";
js.src = transurl;
myjson3=js;
js.onload = function(){setTimeout("head.removeChild(myjson3);",100);};
var timer=gettimer();
if(timer>ttranslate+3000){
  ttranslate=timer;head.appendChild(js);return 1;
}else{return 0;}
}
getlistlang();
var langcombo="en",icombo=0;
langcombo="auto";icombo=1;document.getElementById('combo').selectedIndex=icombo;
langcombo="fr";icombo=2;document.getElementById('combo').selectedIndex=icombo;
icombo=-1;
function subcombo(){
langcombo="en";
icombo=document.getElementById('combo').selectedIndex;
if(icombo>=0+ilang){
  langcombo=document.getElementById('combo')[icombo].id;
}else{langcombo=document.getElementById('combo')[icombo].value;
}
ttranslate=0;if(langcombo!="auto"){lang=langcombo;};
document.getElementById('intext').focus()
if(langcombo0!=langcombo && tspeaktext==2){ifiletext0=ifiletext;setTimeout('saytxt0();',100);}
}
//readcookie();
//savecookie();
//deletecookie();
	setTimeout("init();",2000);
	//init();
	//alert("okend"); 
	
  </script>
<script type="text/javascript">
function subimport(){
if (window.File && window.FileReader && window.FileList && window.Blob) {
  // Great success! All the File APIs are supported.
}else{alert('The File APIs are not fully supported in this browser.');return;}
document.getElementById('files').click();
}
var filename="",filetext="";
function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var filename2=(escape(files[0].name)),test=1;
	if(filename2.substr(filename2.length-3,3).toLowerCase()!="txt"){test=confirm('file is not .txt ,continue ?');}
	if(!test){alert("cancelled");return;}
	filename=filename2;
	ifiletext=0;
	var reader = new FileReader();
    reader.onload = (function(e) {
        filetext=(e.target.result);
		setTimeout('saytxt0();',100);
      });
    reader.readAsText(files[0],'utf-8');
    //reader.readAsText(files[0], 'ISO-8859-1');
}
document.getElementById('files').addEventListener('change', handleFileSelect, true);
var filenameinit="",ifiletextinit=0,icomboinit=-1;
function subinit(){
if(localStorage){
var aux=localStorage.getItem("read_chung_filename");
if(aux){filenameinit=aux;}
aux=localStorage.getItem("read_chung_ifiletext");
if(aux){ifiletextinit=parseInt(aux);}
aux=localStorage.getItem("read_chung_langcombo");
if(aux){langcombo=aux;}
aux=localStorage.getItem("read_chung_icombo");
if(aux){icombo=parseInt(aux);icomboinit=icombo;}
}}
function subsave(){
if(localStorage){
 if(filename){
  if(filename!=""){
   filenameinit=filename;
   ifiletextinit=ifiletext;               
   localStorage.setItem("read_chung_filename",filename);
   localStorage.setItem("read_chung_ifiletext",ifiletext);
}}
  if(icombo>=0){
   localStorage.setItem("read_chung_langcombo",langcombo);
   localStorage.setItem("read_chung_icombo",icombo);}
}
alert("saved !");
}
subinit();
</script>
 </BODY>
</HTML>
